<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--  æ”¾å…¥é€™ä¸‰è¡Œé–‹å§‹ -->
    <link rel="icon" type="image/png" href="./img/icon.png" />
    <link rel="apple-touch-icon" href="./img/icon.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="./img/icon.png" />
    <!--  æ”¾å…¥é€™ä¸‰è¡ŒçµæŸ -->
    <title>å¯µç‰©å¹´é½¡è¨ˆç®—æ©Ÿ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Microsoft JhengHei", Arial, sans-serif;
        background-color: #4f89b1;
        transition: background-color 0.3s ease;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .container {
        width: 70vw;
        height: 100vh;
        display: flex;
        flex-direction: row-reverse;
        align-items: center;
        justify-content: center;
        gap: 2rem;
        padding: 2rem;
        transition: flex-direction 0.3s ease;
      }

      .pet-image {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .pet-image img {
        max-width: 100%;
        max-height: 80vh;
        object-fit: contain;
      }

      .calculator {
        flex: 1;
        min-height: 50%;
        background: white;
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      .pet-toggle {
        display: flex;
        gap: 1rem;
        justify-content: center;
      }

      .pet-toggle button {
        flex: 1;
        padding: 1rem;
        border: 2px solid #ddd;
        background: white;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1.1rem;
        transition: all 0.3s ease;
      }

      .pet-toggle button.active {
        background: #4f89b1;
        color: white;
        border-color: #4f89b1;
      }

      .pet-toggle button.dog.active {
        background: #e2b355;
        border-color: #e2b355;
      }

      .input-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .input-group label {
        font-size: 1rem;
        color: #333;
        font-weight: bold;
      }

      .input-group input {
        padding: 0.8rem;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .input-group input:focus {
        outline: none;
        border-color: #4f89b1;
      }

      .calculate-btn {
        padding: 1rem;
        background: #4f89b1;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .calculate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .back-btn {
        padding: 1rem;
        background: #6c757d;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .back-btn:hover {
        background: #5a6268;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .result {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 10px;
        text-align: center;
        min-height: 100px;
        display: none;
        flex-direction: column;
        justify-content: center;
        gap: 0.5rem;
      }

      .result.show {
        display: flex;
      }

      .result-text {
        font-size: 1.1rem;
        color: #333;
        line-height: 1.6;
      }

      .result-reaction {
        font-size: 1rem;
        color: #4f89b1;
        font-weight: 500;
      }

      .info-text {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 8px;
        text-align: center;
      }

      .info-text p {
        font-size: 0.85rem;
        color: #666;
        line-height: 1.6;
      }

      .info-text a {
        color: #4f89b1;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s ease;
      }

      .info-text a:hover {
        color: #3d6d8f;
        text-decoration: underline;
      }

      /* RWD - å¹³æ¿ */
      @media (max-width: 1024px) {
        .container {
          width: 85vw;
          gap: 1.5rem;
          padding: 1.5rem;
        }

        .calculator {
          padding: 1.5rem;
          gap: 1.2rem;
        }

        .pet-image img {
          max-height: 60vh;
        }
      }

      /* RWD - æ‰‹æ©Ÿ */
      @media (max-width: 768px) {
        body {
          align-items: flex-start;
          padding: 1rem 0;
        }

        .container {
          width: 95vw;
          height: auto;
          min-height: 100vh;
          flex-direction: column !important;
          gap: 1rem;
          padding: 1rem;
        }

        .pet-image {
          width: 100%;
          max-height: 30vh;
          order: 1;
        }

        .pet-image img {
          max-height: 30vh;
          max-width: 80%;
        }

        .calculator {
          width: 100%;
          min-height: auto;
          padding: 1.5rem;
          gap: 1rem;
          order: 2;
        }

        .pet-toggle button {
          padding: 0.8rem;
          font-size: 1rem;
        }

        .input-group label {
          font-size: 0.9rem;
        }

        .input-group input {
          padding: 0.7rem;
          font-size: 0.95rem;
        }

        .calculate-btn,
        .back-btn {
          padding: 0.9rem;
          font-size: 1.1rem;
        }

        .result {
          padding: 1rem;
          min-height: 80px;
        }

        .result-text {
          font-size: 1rem;
        }

        .result-reaction {
          font-size: 0.9rem;
        }

        .info-text {
          padding: 0.8rem;
        }

        .info-text p {
          font-size: 0.75rem;
          line-height: 1.5;
        }
      }

      /* RWD - å°æ‰‹æ©Ÿ */
      @media (max-width: 480px) {
        .container {
          width: 100vw;
          padding: 0.5rem;
        }

        .calculator {
          padding: 1rem;
          gap: 0.8rem;
          border-radius: 15px;
        }

        .pet-toggle {
          gap: 0.5rem;
        }

        .pet-toggle button {
          padding: 0.7rem;
          font-size: 0.9rem;
        }

        .calculate-btn,
        .back-btn {
          padding: 0.8rem;
          font-size: 1rem;
        }

        .result-text {
          font-size: 0.95rem;
        }

        .result-reaction {
          font-size: 0.85rem;
        }

        .info-text p {
          font-size: 0.7rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="pet-image">
        <img id="petImg" src="./img/cat.png" alt="å¯µç‰©åœ–ç‰‡" />
      </div>
      <div class="calculator">
        <div class="pet-toggle">
          <button class="cat active" onclick="togglePet('cat')">ğŸ± è²“è²“</button>
          <button class="dog" onclick="togglePet('dog')">ğŸ¶ ç‹—ç‹—</button>
        </div>
        <div class="input-group">
          <label for="petName">å¯µç‰©åç¨±</label>
          <input type="text" id="petName" placeholder="è«‹è¼¸å…¥å¯µç‰©åç¨±" />
        </div>
        <div class="input-group">
          <label for="petBirthday">å‡ºç”Ÿæ—¥æœŸ</label>
          <input type="date" id="petBirthday" max="9999-12-31" />
        </div>
        <button class="calculate-btn" onclick="calculate()">é–‹å§‹è¨ˆç®—</button>
        <button class="back-btn" onclick="location.href='index.html'">
          è¿”å›é¦–é 
        </button>
        <div class="result" id="result"></div>
        <div class="info-text">
          <p>
            â€»
            <a
              href="https://www.edh.tw/article/31725"
              target="_blank"
              rel="noopener noreferrer"
              >å¹´é½¡æ›ç®—æ¨™æº–</a
            >ï¼š<br />
            è²“ï¼šç¬¬1å¹´=15æ­²ï¼Œç¬¬2å¹´=24æ­²ï¼Œä¹‹å¾Œæ¯å¹´+4æ­²<br />
            ç‹—ï¼šç¬¬1å¹´=15æ­²ï¼Œç¬¬2å¹´=24æ­²ï¼Œä¹‹å¾Œæ¯å¹´+5æ­²
          </p>
        </div>
      </div>
    </div>

    <script>
      let currentPet = "cat";

      // é™åˆ¶æ—¥æœŸè¼¸å…¥æ¡†çš„å¹´ä»½è¼¸å…¥
      document.addEventListener("DOMContentLoaded", function () {
        const dateInput = document.getElementById("petBirthday");
        dateInput.addEventListener("keydown", function (e) {
          // å…è¨±ç‰¹æ®ŠæŒ‰éµï¼ˆTab, Backspace, Delete, æ–¹å‘éµç­‰ï¼‰
          if (
            e.key === "Tab" ||
            e.key === "Backspace" ||
            e.key === "Delete" ||
            e.key === "ArrowLeft" ||
            e.key === "ArrowRight"
          ) {
            return;
          }
          // å¦‚æœä¸æ˜¯æ•¸å­—ï¼Œé˜»æ­¢è¼¸å…¥
          if (!/^\d$/.test(e.key)) {
            e.preventDefault();
          }
        });

        // è¼‰å…¥å„²å­˜çš„è³‡æ–™
        loadSavedData();
      });

      // è¼‰å…¥å„²å­˜çš„è³‡æ–™
      function loadSavedData() {
        try {
          const catData = localStorage.getItem("petAgeCalculator_cat");
          const dogData = localStorage.getItem("petAgeCalculator_dog");

          // é è¨­è¼‰å…¥è²“çš„è³‡æ–™ï¼ˆå› ç‚ºé è¨­æ˜¯è²“ï¼‰
          if (catData) {
            const data = JSON.parse(catData);
            if (data.petName && data.petBirthday) {
              document.getElementById("petName").value = data.petName;
              document.getElementById("petBirthday").value = data.petBirthday;

              // è‡ªå‹•è¨ˆç®—ä¸¦é¡¯ç¤ºçµæœ
              setTimeout(() => {
                calculateWithoutAlert();
              }, 100);
            }
          }
        } catch (e) {
          console.error("è¼‰å…¥è³‡æ–™å¤±æ•—:", e);
        }
      }

      // å„²å­˜è³‡æ–™åˆ° localStorageï¼ˆåˆ†åˆ¥å„²å­˜è²“å’Œç‹—ï¼‰
      function saveData(petType, petName, petBirthday) {
        const data = {
          petName: petName,
          petBirthday: petBirthday,
        };
        localStorage.setItem(
          `petAgeCalculator_${petType}`,
          JSON.stringify(data)
        );
      }

      // è¼‰å…¥å°æ‡‰å¯µç‰©é¡å‹çš„è³‡æ–™
      function loadPetData(petType) {
        try {
          const savedData = localStorage.getItem(`petAgeCalculator_${petType}`);
          if (savedData) {
            const data = JSON.parse(savedData);
            if (data.petName && data.petBirthday) {
              document.getElementById("petName").value = data.petName;
              document.getElementById("petBirthday").value = data.petBirthday;

              // è‡ªå‹•è¨ˆç®—ä¸¦é¡¯ç¤ºçµæœ
              setTimeout(() => {
                calculateWithoutAlert();
              }, 100);
            } else {
              clearInputs();
            }
          } else {
            clearInputs();
          }
        } catch (e) {
          console.error("è¼‰å…¥è³‡æ–™å¤±æ•—:", e);
          clearInputs();
        }
      }

      // æ¸…ç©ºè¼¸å…¥æ¡†å’Œçµæœ
      function clearInputs() {
        document.getElementById("petName").value = "";
        document.getElementById("petBirthday").value = "";
        const resultDiv = document.getElementById("result");
        resultDiv.classList.remove("show");
        resultDiv.innerHTML = "";
      }

      function togglePet(petType) {
        currentPet = petType;
        const container = document.querySelector(".container");
        const body = document.body;
        const petImg = document.getElementById("petImg");
        const catBtn = document.querySelector(".pet-toggle .cat");
        const dogBtn = document.querySelector(".pet-toggle .dog");
        const calculateBtn = document.querySelector(".calculate-btn");

        if (petType === "cat") {
          container.style.flexDirection = "row-reverse";
          body.style.backgroundColor = "#4f89b1";
          petImg.src = "./img/cat.png";
          catBtn.classList.add("active");
          dogBtn.classList.remove("active");
          calculateBtn.style.backgroundColor = "#4f89b1";
          updateReactionColor("#4f89b1");
        } else {
          container.style.flexDirection = "row";
          body.style.backgroundColor = "#e2b355";
          petImg.src = "./img/dog.png";
          dogBtn.classList.add("active");
          catBtn.classList.remove("active");
          calculateBtn.style.backgroundColor = "#e2b355";
          updateReactionColor("#e2b355");
        }

        // è¼‰å…¥å°æ‡‰å¯µç‰©é¡å‹çš„è³‡æ–™
        loadPetData(petType);
      }

      function updateReactionColor(color) {
        const reactionElements = document.querySelectorAll(".result-reaction");
        reactionElements.forEach((el) => {
          el.style.color = color;
        });
      }

      function calculate() {
        const petName = document.getElementById("petName").value.trim();
        const petBirthday = document.getElementById("petBirthday").value;

        if (!petName) {
          alert("è«‹è¼¸å…¥åç¨±");
          return;
        }

        if (!petBirthday) {
          alert("è«‹é¸æ“‡æ—¥æœŸ");
          return;
        }

        // å„²å­˜è³‡æ–™åˆ° localStorage
        saveData(currentPet, petName, petBirthday);

        // åŸ·è¡Œè¨ˆç®—
        performCalculation(petName, petBirthday);
      }

      // ä¸é¡¯ç¤º alert çš„è¨ˆç®—å‡½æ•¸ï¼ˆç”¨æ–¼è‡ªå‹•è¼‰å…¥ï¼‰
      function calculateWithoutAlert() {
        const petName = document.getElementById("petName").value.trim();
        const petBirthday = document.getElementById("petBirthday").value;

        if (!petName || !petBirthday) {
          return;
        }

        performCalculation(petName, petBirthday);
      }

      // åŸ·è¡Œè¨ˆç®—é‚è¼¯
      function performCalculation(petName, petBirthday) {
        const resultDiv = document.getElementById("result");
        const birthDate = new Date(petBirthday);
        const today = new Date();
        const ageInDays = Math.floor(
          (today - birthDate) / (1000 * 60 * 60 * 24)
        );
        const petAge = (ageInDays / 365).toFixed(1);

        let humanAge;
        if (currentPet === "dog") {
          if (ageInDays <= 365) {
            humanAge = Math.floor((ageInDays / 365) * 15);
          } else if (ageInDays <= 730) {
            humanAge = Math.floor(15 + ((ageInDays - 365) / 365) * 9);
          } else {
            humanAge = Math.floor(24 + ((ageInDays - 730) / 365) * 5);
          }
        } else {
          if (ageInDays <= 365) {
            humanAge = Math.floor((ageInDays / 365) * 15);
          } else if (ageInDays <= 730) {
            humanAge = Math.floor(15 + ((ageInDays - 365) / 365) * 9);
          } else {
            humanAge = Math.floor(24 + ((ageInDays - 730) / 365) * 4);
          }
        }

        const petTypeText = currentPet === "cat" ? "è²“" : "ç‹—";
        const reaction = getReaction(humanAge);
        const reactionColor = currentPet === "cat" ? "#4f89b1" : "#e2b355";

        resultDiv.innerHTML = `
                <div class="result-text">
                    ${petName}çš„${petTypeText}é½¡æ˜¯ ${petAge} æ­²<br>
                    æ›ç®—æˆäººé¡å·²ç¶“ ${humanAge} æ­²äº†!
                </div>
                <div class="result-reaction" style="color: ${reactionColor};">${reaction}</div>
            `;
        resultDiv.classList.add("show");
      }

      function getReaction(humanAge) {
        if (humanAge < 1) {
          return "é‚„æ˜¯å€‹å°å¯¶å¯¶å‘¢ï¼è¦å¥½å¥½ç…§é¡§å–”ï½";
        } else if (humanAge < 10) {
          return "æ­£å€¼æ´»æ½‘å¥½å‹•çš„å¹´ç´€ï¼Œå……æ»¿å¥½å¥‡å¿ƒï¼";
        } else if (humanAge < 20) {
          return "é’æ˜¥æœŸçš„å›é€†å°‘å¹´ï¼Œç²¾åŠ›æ—ºç››ï¼";
        } else if (humanAge < 40) {
          return "æ­£å€¼å£¯å¹´ï¼Œæ˜¯æœ€æœ‰æ´»åŠ›çš„æ™‚æœŸï¼";
        } else if (humanAge < 60) {
          return "æˆç†Ÿç©©é‡ï¼Œç¶“é©—è±å¯Œçš„ä¸­å¹´æ™‚æœŸã€‚";
        } else if (humanAge < 80) {
          return "é€²å…¥è€å¹´äº†ï¼Œè¦æ›´åŠ ç´°å¿ƒç…§é¡§å–”ï¼";
        } else {
          return "å·²ç¶“æ˜¯é«˜é½¡é•·è€…äº†ï¼Œè«‹çµ¦äºˆæ›´å¤šçš„é—œæ„›èˆ‡ç…§è­·ï¼";
        }
      }
    </script>
  </body>
</html>
